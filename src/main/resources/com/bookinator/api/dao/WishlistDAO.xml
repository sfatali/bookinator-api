<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE mapper PUBLIC '-//mybatis.org//DTD Mapper 3.0//EN'
        'http://mybatis.org/dtd/mybatis-3-mapper.dtd'>
<mapper namespace="com.bookinator.api.dao.WishlistDAO">

    <insert id="addToWishlist" parameterType="com.bookinator.api.model.Wishlist">
        INSERT INTO books_wish_list(user_id, book_id) VALUES(#{userId}, #{bookId});
    </insert>

    <!--<select id="test" resultMap="TestMap">
        select book_id, user_id from books_wish_list;
    </select>-->

    <delete id="removeFromWishlist" parameterType="com.bookinator.api.model.Wishlist">
        DELETE  from books_wish_list WHERE user_id = #{userId} AND book_id = #{bookId};
    </delete>

    <select id="getUserWishlist" parameterType="int" resultMap="BookDtoMap">
        select b.id, b.owner_id, b.name, coalesce(b.authors, '') as authors, coalesce(b.topics, '') as topics,
                                         coalesce(b.description, '') as description, coalesce(cast(b.year_published as varchar), '') as year_published,
                                         bht.name as holding_type, bst.name as status, f.name as field
        from books_wish_list l, books b
            left join book_holding_types bht on b.holding_type_id = bht.id
            left join book_status_types bst on b.status_id = bst.id
            left join fields f on b.field_id = f.id
        where b.id = l.book_id and l.user_id = #{id}
        order by b.name asc;
    </select>

    <resultMap id="BookDtoMap" type="com.bookinator.api.model.dto.Book">
        <result property="id" column="id"/>
        <result property="ownerId" column="owner_id"/>
        <result property="ownerAvgRating" column="owner_avg_rating"/>
        <result property="holdingType" column="holding_type"/>
        <result property="status" column="status"/>
        <result property="authors" column="authors"/>
        <result property="city" column="city"/>
        <result property="yearPublished" column="year_published"/>
        <result property="field" column="field"/>
        <result property="topics" column="topics"/>
        <result property="description" column="description"/>
    </resultMap>

    <!--<resultMap id="TestMap" tycom.bookinator.api.model.dto.Wishlist        <result property="bookId" column="book_id"/>
        <result property="userId" column="user_id"/>
    </resultMap>-->
</mapper>